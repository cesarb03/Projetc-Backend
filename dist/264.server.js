"use strict";exports.id=264,exports.ids=[264],exports.modules={576:(t,e,r)=>{r.d(e,{Z:()=>s});var i=r(147),o=r.n(i);const s=class{constructor(t){this.fileName=t,this.connect(),o().existsSync(`./${this.fileName}`)||o().promises.writeFile(`./${this.fileName}`,"").then((()=>console.log(`${this.fileName} created`)))}connect(){console.log("connected to filesystem")}}},264:(t,e,r)=>{r.r(e),r.d(e,{default:()=>d});var i=r(147),o=r.n(i),s=r(576),n=function(t,e,r,i){return new(r||(r=Promise))((function(o,s){function n(t){try{d(i.next(t))}catch(t){s(t)}}function c(t){try{d(i.throw(t))}catch(t){s(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,c)}d((i=i.apply(t,e||[])).next())}))};class c extends s.Z{constructor(){super("./src/data/cart.txt"),this.writeFile=t=>n(this,void 0,void 0,(function*(){try{yield o().promises.writeFile(this.fileName,JSON.stringify(t,null,2))}catch(t){console.log("Method: writeFile, ",t)}})),this.readCartFile=()=>n(this,void 0,void 0,(function*(){try{return(yield o().promises.readFile(this.fileName,"utf8"))?JSON.parse(yield o().promises.readFile(this.fileName,"utf8")):[]}catch(t){if(-2===t.errno)try{return yield o().promises.writeFile(this.fileName,JSON.stringify([])),[]}catch(t){console.error("Method: readFile: could not create file in such directory.",t)}else console.log("Method readFile: ",t);return[]}})),this.readProductsFile=()=>n(this,void 0,void 0,(function*(){try{return(yield o().promises.readFile(this.productFilePath,"utf8"))?JSON.parse(yield o().promises.readFile(this.productFilePath,"utf8")):[]}catch(t){if(-2===t.errno)try{return yield o().promises.writeFile(this.productFilePath,JSON.stringify([])),[]}catch(t){console.error("Could not create file in such directory. ",t)}else console.log("Method readFile: ",t);return[]}})),this.createNewCart=()=>n(this,void 0,void 0,(function*(){try{const t=yield this.readCartFile(),e=(new Date).toLocaleString("es-AR");if(0===t.length||void 0===t)return yield this.writeFile([{cartId:1,timestamp:e,products:[]}]),1;{const r=Math.max(...t.map((t=>t.cartId)))+1;return yield this.writeFile([...t,{cartId:r,timestamp:e,products:[]}]),r}}catch(t){return console.error(t),t}})),this.cartDeleteById=t=>n(this,void 0,void 0,(function*(){try{const e=yield this.readCartFile();if(0===e.length||void 0===e)return-1;{const r=e.filter((e=>e.cartId!==t));return r.length===e.length?-2:(yield this.writeFile(r),200)}}catch(t){return console.error(t),t}})),this.getProductsByCartId=t=>n(this,void 0,void 0,(function*(){try{const e=(yield this.readCartFile()).find((e=>e.cartId===t));if(void 0!==e){const t=e.products;return 0===t.length?new Error("Cart has no products."):t}return new Error("Cart not found")}catch(t){return console.error(t),t}})),this.addProductsById=(t,e)=>n(this,void 0,void 0,(function*(){try{const r=Number(e.id),i=yield this.readCartFile(),o=i.find((e=>e.cartId===t)),s=(yield this.readProductsFile()).filter((t=>{if(t.id===r)return t}));if(0===s.length)return new Error(`There is no such product with id= ${r}`);if(void 0!==o&&void 0!==s){const e=[...o.products,...s],r=i.map((r=>r.cartId===t?Object.assign(Object.assign({},r),{products:e}):r));return yield this.writeFile(r),s}}catch(t){return console.error(t),t}})),this.deleteProductByCartId=(t,e)=>n(this,void 0,void 0,(function*(){try{const r=yield this.readCartFile(),i=r.find((e=>e.cartId===t));if(void 0===i)return new Error(`Cart id=${t} not found.`);{const o=i.products.filter((t=>t.id!==e));if(o.length===i.products.length)return new Error(`Product id=${e} not found in cart id=${t}.`);{const e=r.map((e=>e.cartId===t?Object.assign(Object.assign({},e),{products:o}):e));yield this.writeFile(e)}}}catch(t){return console.error(t),t}})),this.productFilePath="./src/data/products.txt"}}const d=new c}};